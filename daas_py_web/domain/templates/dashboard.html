{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .nav-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .nav-tabs div {
            padding: 10px;
            border-bottom: 2px solid transparent;
        }
        .nav-tabs div.active {
            font-weight: bold;
            border-bottom: 2px solid black;
        }
        .search-box {
            margin-bottom: 10px;
        }
        .data-grid {
            width: 100%;
            min-height: 200px;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>

    <h2>Dashboard</h2>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <div class="tab active" data-tab="account">Account</div>
        <div class="tab" data-tab="facility">Facility</div>
        <div class="tab" data-tab="asset">Asset</div>
        <div class="tab" data-tab="service">Service</div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
        <input type="text" id="search-input" placeholder="Search...">
        <button id="search-btn">Search</button>
    </div>

    <!-- Data Grid -->
    <div class="data-grid" id="data-grid">
        <p>Loading Account data...</p>
    </div>

    <script>
        $(document).ready(function() {
            let selectedTab = "account";  // Default tab
    
            function fetchData() {
                let searchQuery = $("#search-input").val().trim();  // Get input value
                $("#data-grid").html("<p>Loading...</p>");
                $.ajax({
                    url: `/fetch-tab-data/${selectedTab}/`,
                    method: "GET",
                    data: { search: searchQuery },  // Send search query
                    success: function(data) {
                        if (data.length === 0) {
                            $("#data-grid").html("<p>No records found.</p>");
                        } else {
                            let table = "<table border='1' width='100%'><tr>";
                            Object.keys(data[0]).forEach(key => {
                                table += `<th>${key}</th>`;
                            });
                            table += "</tr>";
                            data.forEach(row => {
                                table += "<tr>";
                                Object.values(row).forEach(value => {
                                    table += `<td>${value}</td>`;
                                });
                                table += "</tr>";
                            });
                            table += "</table>";
                            $("#data-grid").html(table);
                        }
                    },
                    error: function(err) {
                        $("#data-grid").html("<p>Error fetching data.</p>");
                    }
                });
            }
    
            // Handle tab click
            $(".tab").click(function() {
                $(".tab").removeClass("active");
                $(this).addClass("active");
                selectedTab = $(this).data("tab");
                fetchData();  // Load data for new tab
            });
    
            // Handle search button click
            $("#search-btn").click(function() {
                fetchData();  // Fetch filtered results
            });
    
            // Handle Enter key press in search box
            $("#search-input").keypress(function(event) {
                if (event.which == 13) {  // Enter key pressed
                    fetchData();
                }
            });
    
            // Initial data fetch for the default tab
            fetchData();
        });
    </script>    

</body>
</html>
